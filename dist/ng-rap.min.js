angular.module("ngRap",[]).provider("ngRap",[function(){function b(a,b){return a.some(function(a){return"string"==typeof a&&(b.indexOf(a)>=0||a.indexOf(b)>=0)||(!!("object"==typeof a&&a instanceof RegExp&&a.test(b))||void 0)})}var a=this;this.enable=function(a){this.enabled=!0,this.mode=a.mode||!1,this.serviceUrl=a.serviceUrl,this.blackList=a.blackList||[],this.processResponse=a.processResponse||function(){}},this.$get=["$injector","$q",function(c,d){function e(){var b=d.defer(),c=document.createElement("script");return c.src=a.script,c.onload=c.onreadystatechange=function(a,d){(d||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,c=void 0,d||b.resolve())},document.body.appendChild(c),b.promise}function f(a){if(a instanceof RegExp)return a;if(!a)throw Error("Illegal url:"+a);return a.indexOf("http://")>-1?a=a.substring(a.indexOf("/",7)+1):a.indexOf("https://")>-1&&(a=a.substring(a.indexOf("/",8)+1)),"/"!=a.charAt(0)&&(a="/"+a),a}var g={processResponse:a.processResponse,check:function(a,b){var d=c.get("$http");d.get(a).success(function(a){RAP.checkerHandler.call({data:b},a)})},intercept:function(d){var e=RAP.getMode();RAP.setBlackList(a.blackList.concat([/html/g]));var g=d.url.replace(a.serviceUrl,""),h="http://"+RAP.getHost()+"/mockjsdata/"+RAP.getProjectId(),i=h+f(g),j=RAP.getWhiteList();c.get("$http");return 0==d.url.indexOf(h)?d:(RAP.router(g)?(d.mocked=!0,d.url=i):0==e&&b(j,g)&&(d.needCheck=i),d)},loaded:a.enabled&&e().then(function(){window.RAP&&RAP.setMode(a.mode)})};return g}]}]).factory("rapMockInterceptor",["$q","ngRap",function(a,b){return{request:function(a){return b.loaded?b.loaded.then(function(){return b.intercept(a)}):a},response:function(a){var c=a.data;return b.processResponse(a),b.loaded&&!a.config.mocked&&b.loaded.then(function(){a.config.needCheck&&b.check(a.config.needCheck,c)}),a}}}]);
