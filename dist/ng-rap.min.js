angular.module("ngRap",[]).provider("ngRap",[function(){function b(a,b){return a.some(function(a){return"string"==typeof a&&(b.indexOf(a)>=0||a.indexOf(b)>=0)||(!!("object"==typeof a&&a instanceof RegExp&&a.test(b))||void 0)})}var a=this;this.enable=function(a){this.enabled=!0,this.mode=a.mode,this.serviceUrl=a.serviceUrl},this.$get=["$injector","$q",function(c,d){function e(){var b=d.defer(),c=document.createElement("script");return c.src=a.script,c.onload=c.onreadystatechange=function(a,d){(d||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,c=void 0,d||b.resolve())},document.body.appendChild(c),b.promise}var f={check:function(a,b){var d=c.get("$http");d.get(a).success(function(a){RAP.checkerHandler.call({data:b},a)})},intercept:function(d){var e=RAP.getMode();RAP.setBlackList([/html/g]);var f=d.url.replace(a.serviceUrl,""),g="http://"+RAP.getHost()+"/mockjsdata/"+RAP.getProjectId(),h=g+f,i=RAP.getWhiteList();c.get("$http");return 0==d.url.indexOf(g)?d:(RAP.router(f)?(d.mocked=!0,d.url=h):0==e&&b(i,f)&&(d.needCheck=h),d)},loaded:a.enabled&&e().then(function(){window.RAP&&RAP.setMode(a.mode)})};return f}]}]).factory("rapMockInterceptor",["$q","ngRap",function(a,b){return{request:function(a){return b.loaded?b.loaded.then(function(){return b.intercept(a)}):a},response:function(a){var c=a.data;return b.loaded&&!a.config.mocked&&b.loaded.then(function(){a.config.needCheck&&b.check(a.config.needCheck,c)}),a}}}]);
